<!DOCTYPE html>
<html lang="en" lang="en-US">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<title> The Florida Reef Resilience Program  &#8211; Data</title>
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" />
	
	<link rel="shortcut icon" href="" />
	<link rel="pingback" href="http://frrp.org/xmlrpc.php" />

	<!-- Theme Hook -->
	<link rel="alternate" type="application/rss+xml" title="The Florida Reef Resilience Program &raquo; Feed" href="http://frrp.org/feed/" />
<link rel="alternate" type="application/rss+xml" title="The Florida Reef Resilience Program &raquo; Comments Feed" href="http://frrp.org/comments/feed/" />
<link rel='stylesheet' id='jquery-plugins-slider-style-css'  href='http://frrp.org/wp-content/plugins/nextgen-nivoslider/stylesheets/nivo-slider.css?ver=3.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='ngg-nivoslider-theme-css'  href='http://frrp.org/wp-content/plugins/nextgen-nivoslider/themes/default/default.css?ver=3.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='google-fonts-css'  href='http://fonts.googleapis.com/css?family=Pacifico%7CCabin%3A400%2C700%2C600%2C500&#038;ver=3.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='nivo-slider-css'  href='http://frrp.org/wp-content/themes/FRRP/stylesheets/nivo-slider.css?ver=3.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='nivo-slider-theme-css'  href='http://frrp.org/wp-content/themes/FRRP/stylesheets/nivo/default.css?ver=3.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='tipsy-css'  href='http://frrp.org/wp-content/themes/FRRP/stylesheets/tipsy.css?ver=3.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='fullcalendar-css'  href='http://frrp.org/wp-content/themes/FRRP/stylesheets/fullcalendar.css?ver=3.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='fancybox-css'  href='http://frrp.org/wp-content/themes/FRRP/javascripts/fancybox/jquery.fancybox-1.3.4.css?ver=3.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='style-css'  href='http://frrp.org/wp-content/themes/FRRP/style.css?ver=3.7.1' type='text/css' media='all' /> 
<link rel='stylesheet' id='media.queries-css'  href='http://frrp.org/wp-content/themes/FRRP/stylesheets/media.queries.css?ver=3.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='custom-css'  href='http://frrp.org/wp-content/themes/FRRP/stylesheets/custom.php?ver=3.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='jquery.lightbox.min.css-css'  href='http://frrp.org/wp-content/plugins/wp-jquery-lightbox/styles/lightbox.min.css?ver=1.4' type='text/css' media='all' />
<script type='text/javascript' src='http://frrp.org/wp-includes/js/jquery/jquery.js?ver=1.10.2'></script>
<script type='text/javascript' src='http://frrp.org/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://frrp.org/wp-content/themes/FRRP/javascripts/jquery-ui-1.8.14.js?ver=3.7.1'></script>
<script type='text/javascript' src='http://frrp.org/wp-content/themes/FRRP/javascripts/html5shiv.js?ver=3.7.1'></script>
<script type='text/javascript' src='http://frrp.org/wp-content/themes/FRRP/javascripts/jquery.tipsy.js?ver=3.7.1'></script>
<script type='text/javascript' src='http://frrp.org/wp-content/themes/FRRP/javascripts/fancybox/jquery.fancybox-1.3.4.pack.js?ver=3.7.1'></script>
<script type='text/javascript' src='http://frrp.org/wp-content/themes/FRRP/javascripts/fancybox/jquery.easing-1.3.pack.js?ver=3.7.1'></script>
<script type='text/javascript' src='http://frrp.org/wp-content/themes/FRRP/javascripts/jquery.mobilemenu.js?ver=3.7.1'></script>
<script type='text/javascript' src='http://frrp.org/wp-content/themes/FRRP/javascripts/jquery.infieldlabel.js?ver=3.7.1'></script>
<script type='text/javascript' src='http://frrp.org/wp-content/themes/FRRP/javascripts/jquery.quicksand.js?ver=3.7.1'></script>
<script type='text/javascript' src='http://frrp.org/wp-content/themes/FRRP/javascripts/fullcalendar.js?ver=3.7.1'></script>
<script type='text/javascript' src='http://frrp.org/wp-content/themes/FRRP/javascripts/advocate.js?ver=3.7.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://frrp.org/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://frrp.org/wp-includes/wlwmanifest.xml" /> 
<link rel='next' title='Next Post' href='http://frrp.org/' />
<meta name="generator" content="WordPress 3.7.1" />
<link rel='canonical' href='http://frrp.org/data/' />
<link rel='shortlink' href='http://frrp.org/?p=40' />

<link rel="stylesheet" type="text/css" href="http://js.arcgis.com/3.7/js/dojo/dijit/themes/tundra/tundra.css">
<link rel="stylesheet" href="http://js.arcgis.com/3.7/js/esri/css/esri.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

<script type="text/javascript">
    
    var locationstring = window.location.href;
// replace() the trailing / with nothing, split on the remaining /, and pop off the last one
	var result = /\/([^\/]*)$/.exec(locationstring)[1];

    indy = window.location.href.indexOf(result)
    
    if (indy > 0) {
    	apploc = window.location.href.slice(0,indy);
    } else {
	    
	    apploc = window.location.href
    }
    
    var dojoConfig = {
    async: true,
    cacheBust: 1,
    parseOnLoad: true,
	gfxRenderer: "canvas,svg",
    packages: [
        { name: "bootstrap", location: "//netdna.bootstrapcdn.com/bootstrap/3.1.1/js", main: "bootstrap.min" },
		{ name: "jquery", location: "//code.jquery.com", main: 'jquery-1.11.0' },
		{ name: "grmapper", location: apploc + "/grm"}
    ]
    };
</script>

 
<script src="http://js.arcgis.com/3.7/"></script>


</head>

<body class="page page-id-40 page-template page-template-template-fullwidth-php tundra">
<header>
  <div class="container"> 
    <!-- Start Menu -->
    <nav>
      <ul id="nav" class="menu"><li id="menu-item-569" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-569"><a href="http://frrp.org/">Home</a></li>
<li id="menu-item-136" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-136"><a href="#">About Us</a>
<ul class="sub-menu">
	<li id="menu-item-52" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-52"><a href="http://frrp.org/about-us/program-description/">Program Description</a></li>
	<li id="menu-item-51" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-51"><a href="http://frrp.org/about-us/partners/">Partners</a></li>
</ul>
</li>
<li id="menu-item-45" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-45"><a href="http://frrp.org/floridas-reefs/">Florida&#8217;s Reefs</a></li>
<li id="menu-item-213" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-213"><a href="http://frrp.org/coral-restoration/">Coral Restoration</a></li>
<li id="menu-item-49" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-49"><a href="http://frrp.org/coral-monitoring/">Coral Monitoring</a></li>
<li id="menu-item-48" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-40 current_page_item menu-item-48"><a href="http://frrp.org/data/">Data</a></li>
<li id="menu-item-47" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-47"><a href="http://frrp.org/get-involved/">Get Involved</a></li>
<li id="menu-item-46" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-46"><a href="http://frrp.org/publications-resources/">Publications &#038; Resources</a></li>
<li id="menu-item-557" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-557"><a href="http://frrp.org/Courses">Courses</a></li>
</ul>    </nav>
    <!-- End Menu --> 
    
    <!-- Start Social Icons -->
    <aside>
      	<ul class="social icon"></ul>
    </aside>
    <!-- End Social Icons --> 
  </div>
</header>
<section class="page_heading">
  <div class="logo container"> 
      </div>
</section>

<div class="page_wrapper">
  <section class="container"> 
    
    <!-- Start Page Content -->
    
    <div id="Data" class="page">
      	
      	<h1>Data</h1>
 	
	<div style="position:absolute;padding-top:60px;padding-right:0px;z-index:5000;width:1100px">	
	 <div style="float:right">	
	 
	 Select: <span id="aggdropdown"></span>  <span id="varsdropdown"></span> <span style="padding-left:10px">Filter by:</span> <span id="yeardropdown"></span><span id="diseasesdropdown"> </span></span><span id="speciesdropdown"> 
	
	 </div>
	</div>      		

      	<div class="column-wrapper">
	

	
	<div id="map" style="height: 600px;padding-bottom: 15px"></div>	
		
<div style="margin-left: 90px;">
<div style="border: #0b97cb 3px solid; padding: 1px; float: left; width: 370px;">
<p><a href="https://frrp.org/cgi-bin/entry/login.cgi" target="_blank"><img style="padding-right: 10px; width: 66px; height: 53px;" alt="Login" src="http://frrp.org/images/DataEntry50x50.jpg" width="90" height="68" align="left" border="0" /></a></p>
<p><strong>FRRP Surveyors: </strong> click the icon to login to the online data entry system.</p>
</div>
<div style="border: #0b97cb 3px solid; padding: 1px 4px; float: left; width: 370px; margin-left: 20px;">
<p><a href="http://frrp.org/cgi-bin/query/start.cgi" target="_blank"><img style="padding-right: 10px; width: 125px; height: 67px;" alt="Query" src="http://frrp.org/images/Query.gif" width="125" height="67" align="left" border="0" hspace="10" /></a></p>
<p>Click the icon to generate reports from the collected FRRP data</p>
</div>
</div>
</div>

      
    </div>
    <!-- End Page Content --> 
    
  </section>
</div>

<footer>
<div style="color:#ddd; padding-top:14px; padding-bottom:4px; margin-top:-98px;margin-bottom:100px; font-size:11px;">
<center><a href="mailto:info@frrp.org" style="color:#FFF; text-decoration:none;">Contact Us</a> |   <a href="http://www.nature.org/about-us/governance/privacy-policy.xml?src=f6" target="_blank" style="color:#FFF; text-decoration:none;">Privacy Statement</a> | <a href="http://www.conservationgateway.org/Pages/Terms-of-Use.aspx" target="_blank" style="color:#FFF; text-decoration:none;">Legal Disclosure</a>
</center>
</div>
  <div class="container">
    <div class="clear"></div>
	
    <center>
      <img src="logo_small.png" width="177" height="67" />
    </center>
    <div class="copy"><p>Copyright &copy; 2013 FRRP. All Rights Reserved.<br>This website is owned by The Nature Conservancy and is part of the suite of science resources that are governed by the Terms of Use of the Conservancy’s primary science website Conservationgateway.org and the Privacy policy.&nbsp;&nbsp;|&nbsp;&nbsp; Website by <a href="http://www.floridakeys.com/info/" target="_blank">Floridakeys.com</a></p></div>
  </div>


    <script>
      var map, mainlayer;
      
      var add, vdd, sdd, ddd, ydd;
	  
	  mainURL = "http://frrpmaps.mapossum.org/arcgis/rest/services/frrp/frrpData/MapServer";
	  
	  define.amd.jQuery = true;

      require([
			"dojo/_base/array", 
			"esri/layers/ArcGISDynamicMapServiceLayer",
			"esri/layers/LayerDataSource",
			"esri/layers/QueryDataSource",
			"esri/layers/DynamicLayerInfo",
			"esri/tasks/QueryTask",
			"esri/tasks/query",
			"esri/SpatialReference",	
			"esri/layers/LayerDrawingOptions",
			"esri/renderers/SimpleRenderer",
			"esri/symbols/SimpleLineSymbol",
			"esri/symbols/SimpleFillSymbol",
			"esri/symbols/SimpleMarkerSymbol",
			"esri/renderers/ClassBreaksRenderer",
			"dojo/_base/Color",			
			"dojo/_base/lang", 
			"dijit/form/DropDownButton", 
			"dijit/DropDownMenu", 
			"dijit/MenuItem", 
			"dojo/dom", 
			"dojo/on",
			"dojo/Evented",
			"esri/map", 
			"dojo/ready",
			"jquery",
			"bootstrap",
			"grmapper/grdropdown",
			"dojo/domReady!"
		], function(
			array, 
			ArcGISDynamicMapServiceLayer, 
			LayerDataSource,
			QueryDataSource,
			aDynamicLayerInfo,
			QueryTask,
			esriQuery,
			SpatialReference,
			LayerDrawingOptions,
			SimpleRenderer,
			SimpleLineSymbol,
			SimpleFillSymbol,
			SimpleMarkerSymbol,
			ClassBreaksRenderer,
			Color,
			lang, 
			DropDownButton, 
			DropDownMenu, 
			MenuItem, 
			dom,
			on, 
			Evented,
			Map, 
			ready,
			$,
			bootstrap,
			grdropdown
		) {
	  
	  
	  ready(init) 
	  
	  function init() {
	  
			dataSource = new QueryDataSource();
			

			dataSource.workspaceId = "frrp";
			dataSource.query = "select * from species";
			dataSource.geometryType = "point";
			dataSource.oidFields = ["objectid"] 
			
			//console.log(dataSource.query);
			
			layerSource = new LayerDataSource();
			layerSource.dataSource = dataSource;

			//console.log(layerSource)
			queryTask = new QueryTask(mainURL + "/dynamicLayer", { source: layerSource });

			inquery = new esriQuery();
			inquery.returnGeometry = false;
			//query.outFields = allFields;
			inquery.outFields =["name", "id"]
			inquery.where = "objectid" + " > -1"; 
			
			queryTask.execute(inquery, getSpecies);
		
		
			
		
			years = ["2005","2006","2007","2008","2009","2010","2011","2012"]
			
			//vars = [{name:"Bleaching"},{name:"Disease"},{name:"Recent Mortality"},{name:"Species"}]a
			
			agglevels = [{name:"Site", checked:true},{name:"Zone"},{name:"Sub Region"},{name:"Zone and Sub Region"}]
	
			vars = [{name:"Bleaching"},{name:"Recent Mortality", checked:true},{name:"Presence/Absence"},{name:"Density"}]
			
			//bleachs = [{name:"Bleaching"},{name:"Recent Mortality"}]
			diseases = [{name:"Unknown", value: "UK"},{name:"Black Band", value: "BB"},{name:"Dark Spots", value: "DS"},{name:"Red Band", value: "RB"},{name:"White Band", value: "WB"},{name:"White Plague", value: "WP"},{name:"White Spot", value: "WS"},{name:"Yellow Band/Blotch", value: "YB"}]

			add = new grdropdown("aggdropdown", agglevels, {title:"Aggregation Level", radio: true});
			on(add, "change",function(e) {changemap(e)})
			
			vdd = new grdropdown("varsdropdown", vars, {title:"Variable", radio: true});
			on(vdd, "change",function(e) {changemap(e)})			
			
			ddd = new grdropdown("diseasesdropdown", diseases, {title:"Disease"});
			on(ddd, "change",function(e) {changemap(e)})
			
			ydd = new grdropdown("yeardropdown", years, {title:"Year"});
			on(ydd, "change",function(e) {changemap(e)})
			
			
			this.selectedvalues = {"agglevel":"Site", "variable":"Recent Mortality", "year": "2010", }
			
			map = new Map("map", {
				basemap: "oceans",
				center: [-81.3,25.5], // long, lat
				zoom: 8,
				logo:false,
				sliderStyle: "small"
			});
			
			mainlayer = new ArcGISDynamicMapServiceLayer(
				"http://frrpmaps.mapossum.org/arcgis/rest/services/frrp/frrpData/MapServer",{
				useMapImage: true
				}
			);
			
			map.addLayer(mainlayer);		
			
		}
		
	
		function changemap(e) {
		
			//add, vdd, sdd, ddd, ydd
			
			if (mainlayer != undefined) {
				
				map.removeLayer(mainlayer);
			
			}
			
			adds = add.getselected();
			vdds = vdd.getselected();
			sdds = sdd.getselected();
			ddds = ddd.getselected();
			ydds = ydd.getselected();
			
			console.log(adds, vdds, ydds)
			
			SQL = "select id, count, totalarea, recent_mortality, (recent_mortality / totalarea) * 100 as p_recent_mortality, batch, latitude, longitude, ST_Transform(ST_GeomFromText('POINT(' || longitude::text || ' ' || latitude::text || ')', 4326), 3857) as shape , depth, EXTRACT(year FROM date) as year, code, subregion, zone, habitat from ( select site, sum(count) as count, sum(area) as totalarea, sum(recent_mortality) as recent_mortality from ( select * from (select transect, count(transect) as count, sum(totalarea) as area, sum(recentarea) as recent_mortality from coral group by transect) as coraltab  JOIN transect ON (coraltab.transect = transect.id) ) as transecttab group by site) as sitedata join site on (sitedata.site = site.id) where totalarea > 0"

			yearadd = []
			array.forEach(ydds, function(entry, i){
			
				yearadd.push("EXTRACT(year FROM date) = " + entry.value)
				
			});
			
			
			if (yearadd.length > 0) {
			
				SQL = SQL + " and (" + yearadd.join(" or ") + ")"
			
			}
			
			dadd = []
			array.forEach(ddds, function(entry, i){
			
				dadd.push("disease = '" + entry.value + "'")
				
			});
			
			
			if (dadd.length > 0) {
			
				dSQL = "(" + dadd.join(" or ") + ")"
				//SQL = SQL.replace(" coral ", " coral " + inSQL)
			
			}
			

			sadd = []
			array.forEach(sdds, function(entry, i){
			
				sadd.push("species = " + entry.value + "")
				
			});
			
			
			if (sadd.length > 0) {
			
				sSQL = "(" + sadd.join(" or ") + ")"
				//SQL = SQL.replace(" coral ", " coral " + inSQL)
			
			   if (dadd.length > 0) {
			   
					SQL = SQL.replace(" coral ", " coral where (" + sSQL + " and " + dSQL + ") ")
			   
			   } else {
			   
					SQL = SQL.replace(" coral ", " coral where " + sSQL + " ")
					
			   }
			
			
			} else {
			
				if (dadd.length > 0) {
					
					SQL = SQL.replace(" coral ", " coral where " + dSQL + " ")
			
				}
			
			}

			
			console.log(SQL)			
			
			qSQL = "select 1::integer as id, min(p_recent_mortality) as min, max(p_recent_mortality) as max, count(p_recent_mortality) as n from (" + SQL + ") as bigtab"
	
			qdataSource = new QueryDataSource();
			qdataSource.workspaceId = "frrp";
			//qdataSource.geometryType = "point";
			qdataSource.query = qSQL;
			qdataSource.oidFields = ["id"] 
			//qdataSource.spatialReference = new SpatialReference({wkid: 3857});

			qlayerSource = new LayerDataSource();
			qlayerSource.dataSource = qdataSource;
	
			console.log(qSQL);
			queryTask = new QueryTask(mainURL + "/dynamicLayer", { source: qlayerSource });

			inquery = new esriQuery();
			inquery.returnGeometry = false;
			//query.outFields = allFields;
			inquery.outFields =["*"]
			inquery.where = "id" + " > -1"; 
			
			queryTask.execute(inquery, function(results) {getStats(results,SQL);});
			
			
		}
		
		function getStats(results, SQL) {
			
			console.log("****");
			console.log(results);
			
			if (results.features[0].attributes.n > 0 ) {
				
				//layerSource = new LayerDataSource();
				//layerSource.dataSource = dataSource;
				adds = add.getselected();
				
				if (adds[0].value ==  "Site") {
				  SYM = SimpleMarkerSymbol;
				  oSQL = SQL;
				  geotype = "point";
				  
				var simpleJson = {
				"type": "simple",
				"label": "",
				"description": "",
				"symbol": {
				  "color": [210,105,30,191],
				  "size": 6,
				  "angle": 0,
				  "xoffset": 0,
				  "yoffset": 0,
				  "type": "esriSMS",
				  "style": "esriSMSCircle",
				  "outline": {
					"color": [0,0,128,255],
					"width": 0,
					"type": "esriSLS",
					"style": "esriSLSSolid"
				  }
				}
			  }
				
				symbol = new SYM(simpleJson);
				//symbol.setColor(new Color([150, 150, 150, 0.5]));
				
				renderer = new ClassBreaksRenderer(symbol, "p_recent_mortality");
				renderer.addBreak(0, 2, new SYM().setColor(new Color([56, 168, 0, 1])).setOutline(null).setSize("7"));
				renderer.addBreak(2, 5, new SYM().setColor(new Color([139, 209, 0, 1])).setOutline(null).setSize("7"));
				renderer.addBreak(5, 10, new SYM().setColor(new Color([255, 255, 0, 1])).setOutline(null).setSize("7"));
				renderer.addBreak(10, 20, new SYM().setColor(new Color([255, 128, 0, 1])).setOutline(null).setSize("7"));
				renderer.addBreak(20, Infinity, new SYM().setColor(new Color([255, 0, 0, 1])).setOutline(null).setSize("7"));
				
				} else {
				  SYM = SimpleFillSymbol;
				  oSQL = "SELECT ROW_NUMBER() over() as id, areas_wm_simple.subregion, sum(stab.recent_mortality) as recent_mortality, sum(stab.totalarea) as totalarea, (sum(stab.recent_mortality) / sum(stab.totalarea)) * 100 as p_recent_mortality, ST_Union(areas_wm_simple.shape) as shape from areas_wm_simple join (select * from (" + SQL;
				  oSQL = oSQL + ") as foo) as stab on ST_Intersects(areas_wm_simple.shape, stab.shape) group by areas_wm_simple.subregion";
				  //oSQL = "select * from areas_wm_simple limit 3"
				  geotype = "polygon";
				  
				var simpleJson = {
					  "type": "esriSFS",
					  "style": "esriSFSSolid",
					  "color": [115,76,0,255],
						"outline": {
						 "type": "esriSLS",
						 "style": "esriSLSSolid",
						 "color": [110,110,110,255],
						 "width": 1
						 }
					}
				
				symbol = new SYM(simpleJson);
				//symbol.setColor(new Color([150, 150, 150, 0.5]));
				
				renderer = new ClassBreaksRenderer(symbol, "p_recent_mortality");
				renderer.addBreak(0, 2, new SYM().setColor(new Color([56, 168, 0, 1])).setOutline(null));
				renderer.addBreak(2, 5, new SYM().setColor(new Color([139, 209, 0, 1])).setOutline(null));
				renderer.addBreak(5, 10, new SYM().setColor(new Color([255, 255, 0, 1])).setOutline(null));
				renderer.addBreak(10, 20, new SYM().setColor(new Color([255, 128, 0, 1])).setOutline(null));
				renderer.addBreak(20, 100, new SYM().setColor(new Color([255, 0, 0, 1])).setOutline(null));
				
				//renderer = new SimpleRenderer(symbol);
				
				}
				
				
		
				var dynamicLayerInfos = [];
				var dynamicLayerInfo = new aDynamicLayerInfo();
				dynamicLayerInfo.id = 1;
				dynamicLayerInfo.name = "FRRP";
				
				dataSource = new QueryDataSource();
				dataSource.workspaceId = "frrp";
				dataSource.geometryType = geotype;
				dataSource.query = oSQL;
				dataSource.oidFields = ["id"] 
				dataSource.spatialReference = new SpatialReference({wkid: 3857});
	
				layerSource = new LayerDataSource();
				layerSource.dataSource = dataSource;
				dynamicLayerInfo.source = layerSource;
				dynamicLayerInfos.push(dynamicLayerInfo);
	
				
				mainlayer.setDynamicLayerInfos(dynamicLayerInfos);
				
				console.log(oSQL);
				

		
				alayerDrawingOptions = [];
		
				layerDrawingOption = new LayerDrawingOptions();
				//renderer = new SimpleRenderer(simpleJson);
				layerDrawingOption.renderer = renderer;
				alayerDrawingOptions[1] = layerDrawingOption;
				
				mainlayer.setLayerDrawingOptions(alayerDrawingOptions);
							
				
			} else {
				
				alert("There are no observations that meet the selected filters")
				
			}
		
		}
		
		function getSpecies(results) {
		
			console.log(results)
			
			splist = []
			
			 array.forEach(results.features, function(entry, i){
				 splist.push({"name":entry.attributes.name,"value":entry.attributes.id})
			  });
			
			sdd = new grdropdown("speciesdropdown", splist, {title:"Species", dropright:true});
			on(sdd, "change",function(e) {changemap(e)})
			
			
			changemap();
		
		}
		

	   
		
	});
    
	</script>

</footer>
</body>
</html>